#!/bin/sh
PROG_NAME=$(basename $0)
MSG_PREFIX="$PROG_NAME[$(basename "$(pwd)")]"
. /usr/local/lib/kianidraw-common

is_structure_ok || exit_bad_location "$PROG_NAME"

test -n "$1" || exit_bad_args "\
Usage: $PROG_NAME config[/<property>]
       $PROG_NAME resources[/(all|<resourceName>)]"

class=$(expr "$1" : '\([^/]*\)')
item=$(expr "$1" : '[^/]*/\(.*\)' | sed 's/\//\\\//g')

case $class in
config)
	test -z "$item" && {
		cat "$INTERNAL_CONFIG" "$SYSTEM_CONFIG" \
		| awk '/^[-_0-9a-zA-Z]+=[-_0-9a-zA-Z]+[-_ 0-9a-zA-Z]*/ {print}' \
		| nl -s = \
		| sort -u -t = -k2,2 \
		| cut -d = -f2-
		exit
	}

	value=$(kianidraw-get config | awk -F = "/^$item=/ {print \$2}")
	if test -n "$value"; then
		echo $value
	else
		exit_error "$MSG_PREFIX: \"$1\": not found"
	fi;;

resources)
	test X"$item" = Xall && {
		for r in $(kianidraw-get resources); do
			elements=$(kianidraw-get resources/$r)
			echo $r: $elements
		done
		exit
	}

	cd $INTERNAL_IN_D
	test -z "$item" && {
		find . ! -name . -prune -type l | sed 's/^\.\///'
		exit
	}

	cd "$item".d 2>/dev/null || exit_error "$MSG_PREFIX: \"$1\": not found"
	ls -1 *.png 2>/dev/null | sed 's/\.png//';;

*)
	exit_error "$MSG_PREFIX: \"$class\": unknown class"
esac
